<ion-content fullscreen="true">
  <ion-item lines="none">
    <ion-img src="./assets/logo/anam_logo.png"></ion-img>
    <ion-button class="notifications" slot="end" (click)="openNotifications()">
      <ion-icon name="notifications-outline"></ion-icon>
      <ion-badge color="danger"><span></span></ion-badge>
    </ion-button>
  </ion-item>

  <div class="search-content">
    <ion-searchbar
      placeholder="Rechercher..."
      (ionInput)="onSearchChange($event)"
    ></ion-searchbar>
  </div>

  <div class="filter-group">
    <ion-button
      [ngClass]="selectedFilter === 'tous' ? 'selected' : 'unselect'"
      (click)="onFilterChange('tous')"
      >Tous</ion-button
    >
    <ion-button
      [ngClass]="selectedFilter === 'normal' ? 'selected' : 'unselect'"
      (click)="onFilterChange('normal')"
      >Normal</ion-button
    >
    <ion-button
      [ngClass]="selectedFilter === 'eleve' ? 'selected' : 'unselect'"
      (click)="onFilterChange('eleve')"
      >Elevé</ion-button
    >
    <ion-button
      [ngClass]="selectedFilter === 'urgent' ? 'selected' : 'unselect'"
      (click)="onFilterChange('urgent')"
      >Urgent</ion-button
    >
    <span class="count">({{filteredBulletins.length}})</span>
  </div>

  <!-- Squelettes de chargement -->
  @if (isLoading) { @for (item of [1, 2, 3]; track item) {
  <ion-card class="skeleton-card">
    <div class="skeleton-image-wrapper">
      <ion-skeleton-text [animated]="true"></ion-skeleton-text>
    </div>
    <div class="header">
      <ion-card-header>
        <h3 class="title">
          <div class="skeleton-title-wrapper">
            <ion-skeleton-text [animated]="true"></ion-skeleton-text>
          </div>
        </h3>

        <span class="subtitle">
          <div class="skeleton-subtitle-wrapper">
            <ion-skeleton-text [animated]="true"></ion-skeleton-text>
          </div>
        </span>
      </ion-card-header>
    </div>

    <ion-card-content>
      <div class="skeleton-line-wrapper">
        <ion-skeleton-text [animated]="true"></ion-skeleton-text>
      </div>
      <div class="skeleton-line-wrapper short">
        <ion-skeleton-text [animated]="true"></ion-skeleton-text>
      </div>
      <div class="skeleton-line-wrapper shortest">
        <ion-skeleton-text [animated]="true"></ion-skeleton-text>
      </div>
    </ion-card-content>
  </ion-card>

  } }

  <!-- Contenu réel -->
  @if (!isLoading) { @for (bulletin of filteredBulletins; track bulletin.id) {
  <ion-card>
    <!-- Conteneur pour les images -->
    @if (bulletin.images && bulletin.images.length > 0) {
    <div (click)="goToDetails(bulletin, $event)">
      <img [src]="bulletin.images[0]" alt="Image du bulletin" />
    </div>
    }

    <div class="header" (click)="goToDetails(bulletin, $event)">
      <ion-card-header>
        <!-- Utilisation de createdAt pour la date de publication -->
        <span>{{ bulletin.createdAt.toDate() | date: 'mediumDate' }}</span>
        <h3 class="title">{{ bulletin.title }}</h3>
        <span class="subtitle">
          <!-- Utilisation de endDate pour la date de validité -->
          Valable jusqu'au {{ bulletin.endDate | date: 'fullDate' }}
        </span>
      </ion-card-header>
      <div class="badges">
        <app-badge [severity]="bulletin.severity" />
        <ion-badge *ngIf="bulletin.targetInstitutionId" color="secondary"
          >Spécifique</ion-badge
        >
      </div>
    </div>
    <ion-card-content (click)="goToDetails(bulletin, $event)">
      <p>{{ bulletin.description }}</p>
    </ion-card-content>
    <ion-buttons>
      <ion-button class="share" (click)="openShareModal(bulletin)">
        <ion-icon slot="start" name="share-social"></ion-icon>
        <ion-text>Partager</ion-text>
      </ion-button>

      <ion-button class="download">
        <ion-icon name="arrow-down-outline"></ion-icon>
        <ion-text>Télécharger</ion-text>
      </ion-button>
    </ion-buttons>
  </ion-card>
  } @if (filteredBulletins.length === 0) {
  <div class="no-results">
    <ion-icon name="calendar-outline"></ion-icon>
    <h3>Aucun bulletin trouvé</h3>
    <p>Essayez de modifier vos critères de recherche ou de filtre</p>
  </div>
  } }
</ion-content>

<ion-modal id="share-modal" #modal>
  <ng-template>
    <div class="wrapper">
      <h1>Partager via</h1>
      <ion-list>
        <ion-item button="true" detail="false" (click)="modal.dismiss()">
          <ion-img src="assets/logo/facebook.png"></ion-img>
          <ion-label>Facebook</ion-label>
        </ion-item>
        <ion-item button="true" detail="false" (click)="modal.dismiss()">
          <ion-img src="assets/logo/whatsapp.png"></ion-img>
          <ion-label>Whatsapp</ion-label>
        </ion-item>
      </ion-list>
    </div>
  </ng-template>
</ion-modal>
