<ion-header [translucent]="true" mode="ios">
  <ion-toolbar>
    <ion-title>Paramètres</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="user-info">
    @if(currentUser$ | async; as user) {
    <ion-card class="user-card">
      <ion-card-content class="user-card-content">
        <div class="avatar-container">
          <ion-avatar>
            @if (user.photoURL) {
            <img [src]="user.photoURL" alt="User Avatar" />
            } @else {
            <svg
              viewBox="0 0 96 96"
              xmlns="http://www.w3.org/2000/svg"
              role="img"
              aria-label="Avatar"
            >
              <!-- Couleurs personnalisables -->
              <style>
                :root {
                  --avatar-bg: #8a8a8a; /* gris du fond */
                  --avatar-fg: #ffffff; /* silhouette */
                }
              </style>

              <!-- Fond circulaire -->
              <circle cx="48" cy="48" r="46" fill="var(--avatar-bg)" />

              <!-- Tête -->
              <circle cx="48" cy="36" r="14" fill="var(--avatar-fg)" />

              <!-- Épaules / buste -->
              <path
                d="M24 76c0-13.25 10.75-24 24-24s24 10.75 24 24v4H24v-4z"
                fill="var(--avatar-fg)"
              />
            </svg>

            }
          </ion-avatar>
        </div>
        <div class="user-details">
          @if (user.displayName) {
          <ion-text class="user-name">{{ user.displayName }}</ion-text>
          } @else {
          <ion-text class="user-name">Anonyme</ion-text>
          }
          <ion-text class="user-email">{{ user.email }}</ion-text>
        </div>
      </ion-card-content>
    </ion-card>
    } @else {
    <ion-card class="user-card no-user-card">
      <ion-card-content class="user-card-content no-user-content">
        <ion-text class="no-user-message">
          Vous n'êtes pas connecté. Connectez-vous pour voir vos informations.
        </ion-text>
        <ion-button routerLink="/signin" fill="solid" expand="block">
          <ion-icon name="log-in-outline"></ion-icon>
          Se connecter
        </ion-button>
      </ion-card-content>
    </ion-card>
    }
  </div>

  <div class="appearence">
    <h3>Thème</h3>
    <ion-radio-group [value]="currentTheme" (ionChange)="themeChanged($event)">
      <ion-item class="ion-no-padding">
        <ion-radio value="light" labelPlacement="start">Clair</ion-radio><br />
      </ion-item>
      <ion-item class="ion-no-padding">
        <ion-radio value="dark" labelPlacement="start">Sombre</ion-radio><br />
      </ion-item>
      <ion-item class="ion-no-padding">
        <ion-radio value="system" labelPlacement="start">Système</ion-radio
        ><br />
      </ion-item>
    </ion-radio-group>
  </div>

  @if(currentUser$ | async; as user) { @if(!user.isInstitution) {
  <div class="institution">
    <h3>Institution</h3>
    <ion-item class="ion-no-padding" (click)="promptBecomeInstitution()">
      Accéder aux annonces personnalisées
      <ion-icon slot="end" name="chevron-forward-outline"></ion-icon>
    </ion-item>
  </div>
  } }

  <div class="institution">
    <h3>Compte</h3>
    <ion-list>
      @if (!(currentUser$ | async)) {
      <ion-item class="ion-no-padding" routerLink="/signup">
        Créer un compte
        <ion-icon slot="end" name="chevron-forward-outline"></ion-icon>
      </ion-item>
      }

      <ng-container *ngIf="currentUser$ | async as user">
        @if (!user.isAdmin) {
        <ion-item
          class="ion-no-padding"
          (click)="promptBecomeAdmin()"
          *ngIf="!user.isAdmin"
        >
          Devenir administrateur
          <ion-icon slot="end" name="chevron-forward-outline"></ion-icon>
        </ion-item>
        }
        <ion-item class="ion-no-padding" (click)="logout()">
          Se déconnecter
          <ion-icon slot="end" name="chevron-forward-outline"></ion-icon>
        </ion-item>
      </ng-container>
    </ion-list>
  </div>
</ion-content>
